{% extends 'base.html' %}

{% load i18n %}

{% block content %}

    <form id="generate-link">
        <div class="inline-block-center">

            <input class="comparebox" autocomplete="off" type="text" id="pk1" placeholder="Your Key"
                   value="{% if pk1 %}{{ pk1 }}{% endif %}"/>
            <input class="comparebox" autocomplete="off" type="text" id="pk2" placeholder="Your Partner Key"
                   value="{% if pk2 %}{{ pk2 }}{% endif %}"/>
            <button class="compare" type="submit">Ok</button>
        </div>
    </form>

    <div class="flex-center">
        <div class="square green"></div>
        <div class="colortext">Things you both love and should definitely try.</div>

        <div class="square yellow"></div>
        <div class="colortext">Things that you should talk about.</div><br>

        <div class="square red"></div>
        <div class="colortext">Things that are off the list... for now.</div>
    </div>


    <script>
        $(document).ready(function () {
            $("#generate-link").submit(function (e) {
                var pk1 = $("#pk1").val();
                var pk2 = $("#pk2").val();

                if (pk1 == null && pk2 == null) {
                    return;
                }

                var url = "/compare";
                if (pk1) {
                    url += "/" + encodeURIComponent(pk1);
                }
                if (pk2) {
                    url += "/" + encodeURIComponent(pk2);
                }

                window.location = url;

                e.preventDefault();
            });
        });
    </script>


    {% if analyze_results != None %}

        <table class="inline-block-center comparetable">
            <thead>
            <tr>
                <td></td>
                <td class="text-center">{{ pk1 }}</td>
                <td class="text-center">{{ pk2 }}</td>
            </tr>
            </thead>
            <tbody>


            {% for color, categories in analyze_results.items %}
                {% for category, results in categories.items %}
                    <tr>
                        <td style="background-color:whitesmoke">{{ category }}</td>
                        {% for each in results|slice:":1" %}
                            <td style="background-color: {% if color == "green" %}#a7ffbc{% elif color == "yellow" %}#fff88f{% else %}#ff8a8a{% endif %};">{{ each.first }}</td>
                            <td style="background-color: {% if color == "green" %}#a7ffbc{% elif color == "yellow" %}#fff88f{% else %}#ff8a8a{% endif %};">{{ each.second }}</td>
                        {% endfor %}
                    </tr>
                    {% for each in results|slice:"1:" %}
                        <tr>
                            <td></td>
                            <td style="background-color: {% if color == "green" %}#a7ffbc{% elif color == "yellow" %}#fff88f{% else %}#ff8a8a{% endif %};">{{ each.first }}</td>
                            <td style="background-color: {% if color == "green" %}#a7ffbc{% elif color == "yellow" %}#fff88f{% else %}#ff8a8a{% endif %};">{{ each.second }}</td>
                        </tr>
                    {% endfor %}
                {% endfor %}
            {% endfor %}
            </tbody>
        </table>
    {% endif %}


{% endblock %}